apiVersion: batch/v1
kind: Job
metadata:
  name: ue-bake-navmesh
  labels:
    app: ue-pipeline
    task: bake-navmesh
spec:
  backoffLimit: 2
  activeDeadlineSeconds: 43200  # 12小时
  template:
    metadata:
      labels:
        app: ue-pipeline
        task: bake-navmesh
    spec:
      restartPolicy: OnFailure
      containers:
      - name: ue-pipeline
        image: your-registry/ue-pipeline:latest
        
        command: ["python3", "app.py"]
        args: 
          - "bake_navmesh"
          - "--manifest"
          - "examples/job_bake.json"
        
        workingDir: /app/ue_pipeline
        
        env:
        - name: UE_SYSTEM_TYPE
          value: "linux"
        - name: UE_PROJECT_PATH
          value: "/app/ue_template/WorldData/WorldData.uproject"
        - name: UE_EDITOR_CMD
          value: "/usr/local/UnrealEngine/Engine/Binaries/Linux/UnrealEditor-Cmd"
        
        resources:
          requests:
            memory: "16Gi"
            cpu: "4"
          limits:
            memory: "32Gi"
            cpu: "8"
        
        volumeMounts:
        - name: ue-project
          mountPath: /app/ue_template
        - name: output
          mountPath: /app/output
        - name: job-configs
          mountPath: /app/ue_pipeline/examples
          readOnly: true
      
      volumes:
      - name: ue-project
        persistentVolumeClaim:
          claimName: ue-project-pvc
      - name: output
        persistentVolumeClaim:
          claimName: ue-output-pvc
      - name: job-configs
        configMap:
          name: ue-job-configs
